<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Worker Sign In | GritDash</title>
    <link rel="stylesheet" href="homepage-style.css">
    <style>.signin { max-width:420px;margin:2rem auto;padding:1rem }
          .input{width:100%;padding:8px;margin:0.5rem 0}
          .signin-title { font-size: 20px; font-family:Arial, Helvetica, sans-serif; font: arial; font-weight: bold }
          @media screen and (max-width: 450px){
            .signin { width: 400px; }
            .input { width: 350px; }
          }
    </style>
  </head>
  <body>
    <header class="nav-bar">
            <div class="header-container">
                <a href="homepage.html" style="text-decoration:none;"><img class="nav-logo" src="./images/gritdash-logo-1.png" alt="GritDash logo"></a>
                <i class="fa-solid fa-bars menu-icon"></i>
                <div class="header-dropdown hidden">
                    <a class="dropdown-selection" href="homepage.html">Home</a>
                    <a class="dropdown-selection" href="worker-portal.html">Worker Portal</a>
                    <a class="dropdown-selection" href="restaurant-staff-portal.html">Restaurant Staff</a>
                    <a class="dropdown-selection" href="admin.html">Admin Portal</a>
                </div>
                <a class="nav-link" href="homepage.html">Home</a>
                <a class="nav-link" href="worker-portal.html">Worker Portal</a>
                <a class="nav-link" href="restaurant-staff-portal.html">Restaurant Staff</a>
                <a class="nav-link" href="admin.html">Admin Portal</a>
            </div>
            <a href="cart.html" aria-label="Cart" class="cart-anchor">
                <i class="fa-solid fa-cart-shopping badge"></i>
                <p id="cart-count" class="badge-count">0</p>
            </a>
        <script src="./scripts/cart-common.js"></script>
        <script src="./scripts/dropdown-menu.js"></script>
        </header>

    <main class="signin">
      <p class="signin-title">Worker Sign In</p>
      <label>Email</label>
      <input id="who" class="input" placeholder="you@umbc.edu" />
      <label>Password</label>
      <input id="pwd" class="input" type="password" />
      <div style="margin-top:1rem"><button id="signin" class="btn" style="background:#2b6cb0;color:#fff;padding:8px 12px;border-radius:4px;border:none;">Sign In</button></div>
      <div id="msg" style="margin-top:1rem;color:red;display:none"></div>
    </main>

    <script>
      // If already signed in, keep user on worker dashboard
      (function(){
        try{
          const cw = localStorage.getItem('current_worker');
          if(cw){ window.location.href = 'worker.html'; }
        }catch(e){ /* ignore */ }
      })();
      async function fetchWorkers(){
        try{ const r = await fetch('/api/workers'); if(!r.ok) return []; const d = await r.json(); return d.workers||[]; }catch(e){console.error(e); return []}
      }
      document.getElementById('signin').addEventListener('click', async ()=>{
        const who = document.getElementById('who').value.trim().toLowerCase();
        const pwd = document.getElementById('pwd').value || '';
        if(!who){ document.getElementById('msg').textContent='Enter your UMBC email'; document.getElementById('msg').style.display='block'; return; }
        const workers = await fetchWorkers();
        const found = workers.find(w => (w.Email||'').toLowerCase()===who);
        if(!found){ document.getElementById('msg').textContent='Worker not found or not approved yet.'; document.getElementById('msg').style.display='block'; return; }
        // simple password check if present
        if(found.PasswordHash && found.PasswordHash !== pwd){ document.getElementById('msg').textContent='Invalid password'; document.getElementById('msg').style.display='block'; return; }
        localStorage.setItem('current_worker', JSON.stringify(found));
        window.location.href = 'worker.html';
      });
    </script>
  </body>
</html>
