<!DOCTYPE html>
<html>
  <head>
    <title>Apply to be a Worker | GritDash</title>
    <link rel="stylesheet" href="homepage-style.css">
    <style>
      .apply-form { max-width:700px; margin:2rem auto; padding:1rem; }
      .input { width:100%; padding:8px; margin:0.5rem 0; border:1px solid #ddd; border-radius:4px; }
      .btn { background:#2b6cb0; color:white; padding:8px 12px; border:none; border-radius:4px; cursor:pointer; }
    </style>
  </head>
  <body>
    <header class="nav-bar">
      <div class="header-container">
        <img class="nav-logo" src="./images/gritdash-logo-1.png" alt="GritDash logo">
        <a class="nav-link" href="homepage.html">Home</a>
        <a class="nav-link" href="worker-portal.html">Worker Portal</a>
        <a class="nav-link" href="restaurant-staff-portal.html">Restaurant Staff</a>
        <a class="nav-link" href="admin.html">Admin Portal</a>
      </div>
      <a href="cart.html" aria-label="Cart" style="color:inherit;text-decoration:none;">
        <i class="fa-solid fa-cart-shopping badge" style="font-size:22px;"><span id="cart-count" class="badge-count">0</span></i>
      </a>
      <script src="./scripts/cart-common.js"></script>
    </header>

    <main class="apply-form">
      <h2>Student Worker Application</h2>
      <p>Fill out this short form and administrators will review your application.</p>
      <label>Name</label>
      <input id="name" class="input" />
      <label>UMBC Email</label>
      <input id="email" class="input" />
      <label>Phone</label>
      <input id="phone" class="input" />
      <label>Availability / Hours (e.g., Mon 12-3; Tue 4-8)</label>
      <input id="availability" class="input" />
  <label>Password (for sign-in)</label>
      <input id="password" class="input" type="password" />
      <div style="margin-top:1rem"><button id="apply" class="btn">Submit Application</button></div>

      <div id="msg" style="margin-top:1rem;color:green;display:none">Application submitted. Admins will review it shortly.</div>
    </main>

    <footer><img class="footer-logo" src="./images/gritdash-logo-1.png"></footer>

    <script>
      document.getElementById('apply').addEventListener('click', async () => {
        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const availability = document.getElementById('availability').value.trim();
        const password = document.getElementById('password').value || '';

        // Validation
        if(!name) {
          alert('Please provide your name');
          document.getElementById('name').focus();
          return;
        }
        if(name.length < 2) {
          alert('Name must be at least 2 characters');
          document.getElementById('name').focus();
          return;
        }

        if(!email) {
          alert('Please provide your UMBC email');
          document.getElementById('email').focus();
          return;
        }
        // Email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if(!emailRegex.test(email)) {
          alert('Please provide a valid email address');
          document.getElementById('email').focus();
          return;
        }

        // Phone validation (if provided)
        if(phone) {
          const phoneRegex = /^[\d\s\-\(\)]+$/;
          if(!phoneRegex.test(phone)) {
            alert('Please provide a valid phone number');
            document.getElementById('phone').focus();
            return;
          }
        }

        // Password validation
        if(!password) {
          alert('Please provide a password');
          document.getElementById('password').focus();
          return;
        }
        if(password.length < 8) {
          alert('Password must be at least 8 characters');
          document.getElementById('password').focus();
          return;
        }
        if(password.includes(' ')) {
          alert('Password cannot contain spaces');
          document.getElementById('password').focus();
          return;
        }

        // generate a system worker id on submit
        const workerid = 'W-' + Date.now().toString(36).slice(4);

        const app = {
          WorkerID: workerid,
          Name: name,
          Email: email,
          Phone: phone,
          Availability: availability,
          PasswordHash: password
        };

        try {
          const resp = await fetch('/api/worker-applications', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(app)
          });

          if (!resp.ok) {
            const error = await resp.json();
            throw new Error(error.error || 'Failed to submit application');
          }

          document.getElementById('msg').style.display = 'block';
          // Clear the form
          document.getElementById('name').value = '';
          document.getElementById('email').value = '';
          document.getElementById('phone').value = '';
          document.getElementById('availability').value = '';
          document.getElementById('password').value = '';
        } catch (e) {
          alert('Failed to submit application: ' + e.message);
          console.error(e);
        }
      });
    </script>
  </body>
</html>
